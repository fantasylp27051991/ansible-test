- hosts: lamp
  sudo: yes
  tasks:
    - name: Update Package
      shell: sudo apt-get update && sudo apt-get upgrade -y
      args:
        executable: /bin/bash

    - name: Check if MySQL is already installed.
      stat: path=/etc/init.d/mysql
      register: mysql_installed

    - name: Update apt cache if MySQL is not yet installed.
      apt: update_cache=yes
      when: mysql_installed.stat.exists == false

    - name: Install python2 for Ansible
      raw: bash -c "test -e /usr/bin/python || (apt -qqy update && apt install -qqy python-minimal)"
      register: output
      changed_when: output.stdout != ""
    - name: Gathering Facts
      setup:
    roles:
      - apache2
      - mysql
      - php-fpm
    vars:
      mysql_root_password: "mypass"      service: name=apache2 state=running enabled=yes