- hosts: lamp
  sudo: yes
  tasks:
    - name: Update Package
      shell: sudo apt-get update && sudo apt-get upgrade -y
      args:
        executable: /bin/bash

    - name: Install the package "Apache2"
      shell: sudo apt-get install apache2 -y
      args:
        executable: /bin/bash

    - name: Install Apache2
      shell: sudo apt-get install apache2 -y
      args:
        executable: /bin/bash

    - name: Check if MySQL is already installed.
      stat: path=/etc/init.d/mysql
      register: mysql_installed

    - name: Update apt cache if MySQL is not yet installed.
      apt: update_cache=yes
      when: mysql_installed.stat.exists == false

    - name: install mysql-server
      action: apt name=mysql-server
      notify:
        - mysql_secure_installation

    - name: write conf.d/mysqld.cnf
      action: template src=templates/mysqld.cnf.j2 dest=/etc/mysql/conf.d/mysqld.cnf
      notify:
        - restart mysql

    - name: write conf.d/client.cnf
      action: template src=templates/client.cnf.j2 dest=/etc/mysql/conf.d/client.cnf
      notify:
        - restart mysql

    - name: start Apache
      service: name=apache2 state=running enabled=yes